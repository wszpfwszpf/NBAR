# 事件流降噪用于光流评估

本仓库用于探索 **事件流降噪是否能够稳定提升下游光流质量**，  
而非追求事件结构的严格保持或构建通用型降噪器。

当前项目处于 **结构重构与流程稳定阶段**。

---

## 项目目标

本项目的核心目标是：

> 在允许一定误删真实事件的前提下，  
> 验证轻量级事件流降噪策略是否能够 **整体提升光流估计效果**。

本项目 **不是**：
- 结构保持型事件降噪算法  
- 通用事件增强或重建方法  

---

## 整体流程

当前的概念性流程如下：

原始事件流

↓

S1（可选，偏激进的过滤）

↓

S2（可选，补偿 / 细化）

↓

光流评估

- **S1**：  
  允许误删真实事件，只要整体光流质量稳定提升即可。
- **S2**：  
  用于对 S1 的结果进行补偿或细化，不要求严格保持原始结构。

---

## 设计原则与约束

- 事件表示形式固定为 **(t, x, y, p)**。
- 优先考虑 **实时性与工程可部署性**。
- 当前阶段 **刻意避免**：
  - FFT 等频域分析方法  
  - 复杂或大规模深度模型  
  - 离线或全局优化模块  
- 更关注 **工程可控性与实验可验证性**，而非算法复杂度。

---

## 当前状态说明

- 代码正处于 **结构性重构阶段**。
- 当前重构目标：
  - 理清代码结构
  - 明确模块接口
  - 支持 S1 / S2 的可插拔设计
- 本阶段 **不引入新的降噪算法或策略**。

---

## 使用说明

### PyCharm 一键运行（推荐）

1. 打开根目录下的 `S1.py`，根据自己的数据路径修改顶部 `INPUT_NPZ`（默认读取 `data/mvsec_clip_2s.npz`）。直接运行即可自动创建 `outputs/raw/` 和 `outputs/s1/`，并生成 `<name>_raw.npz` 与 `<name>_s1.npz`。
2. 运行 `visual.py` 或 `analyse.py`，脚本默认会从 `outputs/s1/<name>_s1.npz` 读取并进行可视化/分析，无需额外参数。
3. 需要对比指标时，可运行 `conpare_stage1.py`；校验输出可运行 `sanity_check_s1.py`；基线仍在 `baselines/` 下可直接运行。

> NPZ 格式支持：
> - 显式四通道：`t/x/y/p`
> - `events` 矩阵：`N x 4`，列顺序 `(t, x, y, p)`
> - 历史字段 `w1/w2` 等长数组会被自动保留（统一读写在 `nbar.io.load_npz/save_npz`）。

### Minimal repo layout

> 仅保留最小化的回归/核心实现骨架，其他脚本全部在 `legacy/` 下。

- `test.py`：唯一推荐入口，负责回归与输出路径约定。
- `nbar/`：核心事件 I/O 与 Stage S1 实现。
- `utils/`：仅保留 Stage S1 运行所需的配置和权重计算工具。
- `legacy/`：历史 CLI、基线脚本及完整归档（含 `legacy/archived/...`）。

---

## 备注

- 所有中间可视化结果、图片、视频及生成数据均不纳入版本管理。
- 本仓库优先保证 **实验逻辑清晰与可复现性**，而非功能完整性。
